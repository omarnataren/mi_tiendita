<div class="contenedor-tabla">
  <div class="encabezado">
    <h3>Historial de Ventas</h3>
    <div class="acciones">
      <div class="buscar-container">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Buscar..." class="buscar" />
      </div>
    </div>
  </div>

  <table class="tabla-generica">
    <thead>
      <tr>
        <th>ID</th>
        <th>Fecha de venta</th>
        <th>Total de venta</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      @for(venta of historial; track venta.venta_id) {
        <tr>
          <td>{{ venta.venta_id }}</td>
          <td>{{ formatearFecha(venta.fecha_venta) }}</td>
          <td>${{ venta.total.toFixed(2) }}</td>
          <td class="acciones-column">
            <div class="acciones-container">
              <!-- Botón para ver detalle -->
              <div class="acciones-fila" (click)="verDetalle(venta)">
                <i class="fas fa-eye"></i>
              </div>
              
              <!-- Botón menú de opciones -->
              <div class="acciones-fila" (click)="toggleMenu($index, $event); $event.stopPropagation()">
                ⋮
              </div>
              
              <!-- Menú de opciones -->
              @if(menuAbierto === $index) {
                <div class="menu-opciones" [style.top]="menuPosicion.top" >
                  <div class="menu-item modificar" (click)="modificar(venta)">
                    <i class="fas fa-edit"></i> Modificar
                  </div>
                  <div class="menu-item eliminar" (click)="eliminar(venta.venta_id)">
                    <i class="fas fa-trash"></i> Eliminar
                  </div>
                </div>
              }
            </div>
          </td>
        </tr>
      }
      @if(historial.length === 0) {
        <tr>
          <td colspan="4" style="text-align: center; padding: 30px; color: #999;">
            No hay ventas registradas
          </td>
        </tr>
      }
    </tbody>
  </table>

  <div class="paginacion">
    <span>Rows per page: 8</span>
    <span>1-8 of {{ historial.length }}</span>
    <div class="flechas">
      <button>‹</button>
      <button>›</button>
    </div>
  </div>
</div>

<!-- Modal para ver detalle de la venta -->
@if(mostrarModalDetalle && ventaSeleccionada) {
  <div class="modal-overlay" (click)="cerrarModalDetalle()">
    <div class="modal-content modal-detalle" (click)="$event.stopPropagation()">
      <button class="btn-cerrar" (click)="cerrarModalDetalle()">
        <i class="fas fa-times"></i>
      </button>

      <h2 class="modal-titulo">DETALLE DE VENTA #{{ ventaSeleccionada.venta_id }}</h2>

      <div class="info-venta">
        <div class="info-row">
          <span class="label">Fecha:</span>
          <span class="valor">{{ formatearFecha(ventaSeleccionada.fecha_venta) }}</span>
        </div>
        <div class="info-row">
          <span class="label">Total:</span>
          <span class="valor total">${{ ventaSeleccionada.total.toFixed(2) }}</span>
        </div>
      </div>

      <h3 class="subtitulo">Productos vendidos</h3>

      <table class="tabla-detalle">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>Precio Unit.</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          @for(detalle of detallesVenta; track detalle.detalle_id) {
            <tr>
              <td>Producto #{{ detalle.producto_id }}</td>
              <td>{{ detalle.cantidad }}</td>
              <td>${{ detalle.precio_unitario.toFixed(2) }}</td>
              <td>${{ detalle.total.toFixed(2) }}</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
}
