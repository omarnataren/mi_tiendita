<div class="contenedor-tabla">
  <div class="encabezado">
    <h3>Todos los Usuarios</h3>

    <div class="acciones">
      <div class="buscar-container">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Buscar..." class="buscar" />
      </div>

      <button class="agregar" (click)="abrirModal()"><i class="fas fa-plus"></i> Agregar</button>
    </div>
  </div>

  <table class="tabla-generica">
    <thead>
      <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Email</th>
        <th>Rol</th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      @for(usuario of usuarios; track usuario.id) {
      <tr>
        <td>{{ usuario.id }}</td>
        <td>{{ usuario.nombre }}</td>
        <td>{{ usuario.email }}</td>
        <td>{{ usuario.rol }}</td>

        <td class="acciones-column">
          <div class="acciones-fila" (click)="abrirMenu(usuario.id)">⋮</div>

          @if(menuAbierto === usuario.id) {
                <div class="menu-opciones" >
                  <div class="menu-item modificar" (click)="abrirModalEditar(usuario)">
                    <i class="fas fa-edit"></i> Modificar
                  </div>
                  <div class="menu-item eliminar" (click)="abrirModalEliminar(usuario)">
                    <i class="fas fa-trash"></i> Eliminar
                  </div>
                </div>
              }
        </td>
      </tr>
      }
    </tbody>
  </table>
</div>

<!-- ========== MODAL AGREGAR USUARIO ========== -->
@if(mostrarModal) {
<div class="modal-overlay" (click)="cerrarModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="btn-cerrar" (click)="cerrarModal()">
      <i class="fas fa-times"></i>
    </button>

    <h2 class="modal-titulo">NUEVO USUARIO</h2>

    <form class="modal-form">
      <div class="form-row">
        <label>Nombre</label>
        <input type="text" class="input-modal" />
      </div>

      <div class="form-row">
        <label>Email</label>
        <input type="email" class="input-modal" />
      </div>

      <div class="form-row">
        <label>Rol</label>
        <input type="text" class="input-modal" />
      </div>

      <button type="button" class="btn-guardar" (click)="guardarUsuario()">GUARDAR USUARIO</button>
    </form>
  </div>
</div>
}

<!-- ========== MODAL EDITAR USUARIO ========== -->
@if(mostrarModalEditar) {
<div class="modal-overlay" (click)="mostrarModalEditar = false">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="btn-cerrar" (click)="mostrarModalEditar = false">
      <i class="fas fa-times"></i>
    </button>

    <h2 class="modal-titulo">EDITAR USUARIO</h2>

    <form class="modal-form">
      <div class="form-row">
        <label>Nombre</label>
        <input type="text" class="input-modal" [(ngModel)]="usuarioEditando.nombre" name="nombre" />
      </div>

      <div class="form-row">
        <label>Email</label>
        <input type="email" class="input-modal" [(ngModel)]="usuarioEditando.email" name="email" />
      </div>

      <div class="form-row">
        <label>Rol</label>
        <input type="text" class="input-modal" [(ngModel)]="usuarioEditando.rol" name="rol" />
      </div>

      <button type="button" class="btn-guardar" (click)="guardarCambios()">GUARDAR CAMBIOS</button>
    </form>
  </div>
</div>
}

<!-- ========== MODAL ELIMINAR USUARIO ========== -->
@if(mostrarModalEliminar) {
<div class="modal-overlay" (click)="mostrarModalEliminar = false">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="btn-cerrar" (click)="mostrarModalEliminar = false">
      <i class="fas fa-times"></i>
    </button>

    <h2 class="modal-titulo">¿Eliminar usuario?</h2>

    <p style="text-align: center; font-size: 1.1rem">
      Se eliminará <strong>{{ usuarioAEliminar.nombre }}</strong>
    </p>

    <div style="display: flex; justify-content: center; gap: 20px; margin-top: 20px">
      <button class="btn-guardar" style="background: #bbb" (click)="mostrarModalEliminar = false">
        Cancelar
      </button>

      <button class="btn-guardar" style="background: #ff4d4d" (click)="confirmarEliminar()">
        Eliminar
      </button>
    </div>
  </div>
</div>
}
